---
title: "JSON in jq and Postgres"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{JSON in jq and Postgres}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(jsontools)
```

[Postgres manual](https://www.postgresql.org/docs/current/functions-json.html)
[jq manual](https://stedolan.github.io/jq/manual/#Assignment)
[try out jq online](https://jqplay.org/)
[SQLite](https://www.sqlite.org/json1.html)
[SQL 2016](https://modern-sql.com/blog/2017-06/whats-new-in-sql-2016)

|Operator|Description|Example|Example Result|
|--- |--- |--- |--- |
|->|Get JSON array element|'[{"a":"foo"},{"b":"bar"}]'::json->1|{"b":"bar"}|
|->|Get JSON object field by key|'{"a": {"b":"foo"}}'::json->'a'|{"b":"foo"}|
|->>|Get JSON array element as text|'[1,2,3]'::json->>2|3|
|->>|Get JSON object field as text|'{"a":1,"b":2}'::json->>'b'|2|
|#>|Get JSON object at specified path|'{"a": {"b":{"c": "foo"}}}'::json#>'{a,b}'|{"c": "foo"}|
|#>>|Get JSON object at specified path as text|'{"a":[1,2,3],"b":[4,5,6]}'::json#>>'{a,2}'|3|

|json_tools|jq|Postgres|Example Result|
|--- |--- |--- |--- |
|json_keys(x)|jq 'keys'|jsonb_object_keys(x)|
|json_has_key(x, list("a", ))|jq 'all(map(has(x)))'|x ?& array|
|json_has_key(x, )|jq 'all(map(has(x)))'|x ?& array|

jsonb_path_exists



#' TODO overview how one can achieve many things with jqr?
#' postgres jsonb functions
#' ?     does key exist at top level path?
#' -     delete element with specified key
#'
#' array_to_json  --> list_of_vctr to json?
#' row_to_json    --> rowwise conversion of object to json
#' json_array_elements_text --> expand json array in long format
